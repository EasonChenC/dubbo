<!-- Generated by SpecStory -->

# Debugging Dubbo service provider issue (2025-06-12 15:26:08)

_**User**_

@/consumer @/provider 运行测试消费者接口出现org.apache.dubbo.rpc.RpcException: No provider available from registry RegistryDirectory(registry: 192.168.31.91:2181)-Directory(invokers: 0[], validInvokers: 0[], invokersToReconnect: 0[]) for service com.ck.api.service.DemoDubboService on consumer 192.168.31.41 use dubbo version 3.3.4, please check status of providers(disabled, not registered or in blocklist).
	at org.apache.dubbo.registry.integration.DynamicDirectory.doList(DynamicDirectory.java:204) ~[dubbo-3.3.4.jar:3.3.4]
	at org.apache.dubbo.rpc.cluster.directory.AbstractDirectory.list(AbstractDirectory.java:232) ~[dubbo-3.3.4.jar:3.3.4]
	at org.apache.dubbo.rpc.cluster.support.AbstractClusterInvoker.list(AbstractClusterInvoker.java:452) ~[dubbo-3.3.4.jar:3.3.4]
	at org.apache.dubbo.rpc.cluster.support.AbstractClusterInvoker.invoke(AbstractClusterInvoker.java:355) ~[dubbo-3.3.4.jar:3.3.4]
	at org.apache.dubbo.rpc.cluster.router.RouterSnapshotFilter.invoke(RouterSnapshotFilter.java:46) ~[dubbo-3.3.4.jar:3.3.4]
	at org.apache.dubbo.rpc.cluster.filter.FilterChainBuilder$CopyOfFilterChainNode.invoke(FilterChainBuilder.java:349) ~[dubbo-3.3.4.jar:3.3.4]错误

---

_**Assistant**_

我来分析这个Dubbo服务调用失败的问题。首先让我查看一下消费者和提供者的项目结构和配置。

---

<details>
            <summary>Listed directory consumer • **3** results</summary>
        
| Name |
|-------|
| 📁 `target` |
| 📄 `pom.xml` |
| 📁 `src` |

</details>

---

<details>
            <summary>Listed directory provider • **3** results</summary>
        
| Name |
|-------|
| 📁 `target` |
| 📄 `pom.xml` |
| 📁 `src` |

</details>

---

<details>
            <summary>Listed directory consumer/src • **2** results</summary>
        
| Name |
|-------|
| 📁 `main` |
| 📁 `test` |

</details>

---

<details>
            <summary>Listed directory provider/src • **2** results</summary>
        
| Name |
|-------|
| 📁 `main` |
| 📁 `test` |

</details>

---

现在让我查看消费者和提供者的pom.xml配置以及关键源码文件：

---

Read file: consumer/pom.xml

---

Read file: provider/pom.xml

---

现在让我查看消费者和提供者的主要源码目录：

---

<details>
            <summary>Listed directory consumer/src/main • **2** results</summary>
        
| Name |
|-------|
| 📁 `resources` |
| 📁 `java` |

</details>

---

<details>
            <summary>Listed directory provider/src/main • **2** results</summary>
        
| Name |
|-------|
| 📁 `resources` |
| 📁 `java` |

</details>

---

<details>
            <summary>Listed directory consumer/src/main/java • **1** results</summary>
        
| Name |
|-------|
| 📁 `com` |

</details>

---

<details>
            <summary>Listed directory provider/src/main/java • **1** results</summary>
        
| Name |
|-------|
| 📁 `com` |

</details>

---

<details>
            <summary>Searched codebase "dubbo configuration application.yml application.properties" • **15** results</summary>
        
| File | Lines |
|------|-------|
| `provider/src/main/resources/application.yml` | L1-15 |
| `pom.xml` | L27-69 |
| `provider/src/main/java/com/ck/provider/ProviderApplication.java` | L1-15 |
| `provider/pom.xml` | L1-53 |
| `consumer/pom.xml` | L1-56 |
| `pom.xml` | L1-27 |
| `api/pom.xml` | L1-25 |
| `provider/src/main/java/com/ck/provider/service/DemoDubboServiceImpl.java` | L1-21 |
| `src/test/java/com/ck/dubbo/DubboImplApplicationTests.java` | L1-13 |
| `api/src/main/java/com/ck/api/service/DemoDubboService.java` | L1-6 |
| `provider/src/test/java/com/ck/provider/ProviderApplicationTests.java` | L1-13 |
| `api/src/test/java/com/ck/api/ApiApplicationTests.java` | L1-13 |
| `.gitignore` | L1-34 |
| `.cursorindexingignore` | L1-4 |
| `.specstory/.gitignore` | L1-3 |

</details>

---

现在让我查看消费者和提供者的配置文件以及服务实现：

---

Read file: provider/src/main/resources/application.yml

---

<details>
            <summary>Searched codebase "consumer application.yml" • **7** results</summary>
        
| File |
|------|
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |

</details>

---

Read file: consumer/src/main/resources/application.yml

---

现在让我查看消费者的服务实现和控制器：

---

Read file: consumer/src/main/java/com/ck/consumer/ConsumerApplication.java

---

Read file: consumer/src/main/java/com/ck/consumer/service/impl/DemoServiceImpl.java

---

Read file: consumer/src/main/java/com/ck/consumer/controller/DemoController.java

---

Read file: provider/src/main/java/com/ck/provider/service/DemoDubboServiceImpl.java

---

现在让我检查根目录是否有主pom.xml：

---

Read file: pom.xml

---

根据我的分析，出现"No provider available from registry"错误的主要原因是提供者没有成功注册到Zookeeper注册中心。让我为您分析几个可能的问题并提供解决方案：

## 问题分析

从错误信息可以看出：
- 消费者连接到了Zookeeper（192.168.31.91:2181）
- 但是没有找到任何可用的提供者（invokers: 0[], validInvokers: 0[]）
- 服务接口是 `com.ck.api.service.DemoDubboService`

## 主要问题及解决方案

### 1. 版本兼容性问题
您的项目中存在Spring Boot版本冲突：
- 父POM使用 Spring Boot 3.0.4
- 但在dependencyManagement中指定了 Spring Boot 2.3.7.RELEASE

让我修复这个问题：

---

```diff
      <dependencyManagement>
          <dependencies>
-             <dependency>
-                 <groupId>org.springframework.boot</groupId>
-                 <artifactId>spring-boot-starter</artifactId>
-                 <version>2.3.7.RELEASE</version>
-             </dependency>
-             <dependency>
-                 <groupId>org.springframework.boot</groupId>
-                 <artifactId>spring-boot-starter-web</artifactId>
-                 <version>2.3.7.RELEASE</version>
-             </dependency>
- 
              <!-- dubbo 依赖 -->
              <dependency>
```

---

### 2. 修复消费者服务实现中的错误注解

消费者的DemoServiceImpl类中不应该使用@DubboService注解，这个注解是用于提供者的：

---

```diff
  import com.ck.consumer.service.DemoService;
  import org.apache.dubbo.config.annotation.DubboReference;
- import org.apache.dubbo.config.annotation.DubboService;
  import org.springframework.stereotype.Service;
  
```

```diff
   * @Version: 1.0
   */
- @DubboService
  @Service
  public class DemoServiceImpl implements DemoService {
  
-     @DubboReference(loadbalance = "RoundRobin")
+     @DubboReference(loadbalance = "roundrobin")
      private DemoDubboService demoDubboService;
  
```

---

### 3. 添加模块声明到根POM

根POM缺少模块声明：

---

```diff
  
      <packaging>pom</packaging>
+ 
+     <modules>
+         <module>api</module>
+         <module>provider</module>
+         <module>consumer</module>
+     </modules>
  
      <parent>
```

---

### 4. 增强提供者配置

为了确保提供者能正确注册，让我们添加一些额外的配置：

---

```diff
      name: dubbo
      port: 20881
+     host: 192.168.31.41
+   provider:
+     timeout: 5000
+     retries: 0
+   scan:
+     base-packages: com.ck.provider.service
+ 
+ server:
+   port: 8080
+ 
+ logging:
+   level:
+     com.ck: DEBUG
+     org.apache.dubbo: INFO
  
```

---

### 5. 增强消费者配置

同样为消费者添加更详细的配置：

---

```diff
      name: dubbo
      port: 20882
+   consumer:
+     timeout: 5000
+     retries: 0
+     check: false
+ 
  server:
    port: 8999
+ 
+ logging:
+   level:
+     com.ck: DEBUG
+     org.apache.dubbo: INFO
  
```

---

## 排查和解决步骤

现在请按照以下步骤进行排查和解决：

### 1. 确保Zookeeper服务正常运行
首先确认Zookeeper服务在192.168.31.91:2181上正常运行：

---

```bash
telnet 192.168.31.91 2181
```

```
Microsoft Windows [版本 10.0.19044.1766]
(c) Microsoft Corporation。保留所有权利。

D:\personal_project\dubbo\dubboImpl>telnet 192.168.31.91 2181
Microsoft Windows [版本 10.0.19044.1766]
(c) Microsoft Corporation。保留所有权利。

D:\personal_project\dubbo\dubboImpl>telnet 192.168.31.91 2181
```

---

### 2. 重新编译项目
清理并重新编译整个项目：

---

```bash
mvn clean compile -DskipTests
```

```
Microsoft Windows [版本 10.0.19044.1766]
(c) Microsoft Corporation。保留所有权利。

D:\personal_project\dubbo\dubboImpl>telnet 192.168.31.91 2181
Microsoft Windows [版本 10.0.19044.1766]
(c) Microsoft Corporation。保留所有权利。

D:\personal_project\dubbo\dubboImpl>telnet 192.168.31.91 2181






















































D:\personal_project\dubbo\dubboImpl>
```

---





---

